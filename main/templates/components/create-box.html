{% load static %}

<div class="create-art-container">

  <!-- Main Upload Box -->
  <div class="create-box-container">
    <div class="create-box-left">
      <button class="back-btn" onclick="history.back()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"></path>
          </svg>
      </button>
      <div class="upload-image-container" id="uploadContainer">
        <label for="image" class="upload-label" id="uploadLabel">
          <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M21 15l-5-5L5 21"></path>
          </svg>
          <p>Click or drag to upload image</p>
        </label>
        <!-- preview holder stays inside the container; the actual file input is kept inside the form so it will be submitted -->
        <div id="previewHolder"></div>
      </div>
    </div>

    <div class="create-box-right">
      <form method="POST" action="{% url 'upload_art' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="text" id="imtitleage" name="title" placeholder="Title" required>
        <textarea id="imdesc" name="description" placeholder="Description"></textarea>

        <label for="category">Choose a category:</label>
        <select id="category" name="category">
          <option value="">-- Select a Category --</option>
          <option value="3D Art">3D Art</option>
          <option value="2D Art">2D Art</option>
          <option value="Pixel Art">Pixel Art</option>
          <option value="Concept Art">Concept Art</option>
          <option value="Illustration">Illustration</option>
          <option value="Sculptures">Sculptures</option>
          <option value="Motion Graphics">Motion Graphics</option>
          <option value="Animation">Animation</option>
          <option value="Photography">Photography</option>
          <option value="Game Assets">Game Assets</option>
        </select>
      
  <!-- single file input stays inside the form and is referenced by the preview logic -->
  <input type="file" id="image" name="image" accept="image/*" hidden>
  <button type="submit" class="upload-submit">Upload</button>
  </form>
    </div>
  </div>
</div>

<script>
  const fileInput = document.getElementById('image');
  const uploadContainer = document.getElementById('uploadContainer');
  const uploadLabel = document.getElementById('uploadLabel');
  const previewHolder = document.getElementById('previewHolder');

  // helper to render preview without removing file input
  function renderPreview(dataUrl){
    previewHolder.innerHTML = `<img src="${dataUrl}" alt="Preview Image" class="preview-img">`;
  }

  fileInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        renderPreview(e.target.result);
      };
      reader.readAsDataURL(file);
    }
  });

  // Optional: allow drag and drop and forward file to input
  uploadContainer.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadContainer.classList.add('drag-over');
  });

  uploadContainer.addEventListener('dragleave', () => {
    uploadContainer.classList.remove('drag-over');
  });

  uploadContainer.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadContainer.classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file) {
      // assign dropped file to the input so it gets submitted
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);
      fileInput.files = dataTransfer.files;

      const reader = new FileReader();
      reader.onload = function(event) {
        renderPreview(event.target.result);
      };
      reader.readAsDataURL(file);
    }
  });
</script>
